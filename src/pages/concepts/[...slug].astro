---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import { ProjectBadge } from '../../components';
import Annotation from '../../components/Annotation';
import Comments from '../../components/Comments';

export async function getStaticPaths() {
  const concepts = await getCollection('concepts');
  return concepts.map(entry => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}

const { entry } = Astro.props;
const { Content } = await entry.render();
---

<BaseLayout title={`${entry.data.title} | Midnight Learning`}>
  <div class="max-w-4xl mx-auto">
    <div class="mb-12">
      <div class="flex items-center gap-3 mb-6">
        <a href="/" class="text-sm font-medium text-slate-500 hover:text-brand-600 transition-colors">&larr; Back to Hub</a>
        <span class="text-slate-300">/</span>
        <span class="text-sm font-bold text-brand-600 uppercase tracking-wider bg-brand-50 px-2 py-0.5 rounded">{entry.data.category}</span>
      </div>
      
      <h1 class="text-5xl font-extrabold text-slate-900 mb-6 tracking-tight">{entry.data.title}</h1>
      
      <div class="flex items-center flex-wrap gap-6 text-sm text-slate-500 border-b border-slate-100 pb-8">
        <div class="flex gap-2 items-center">
          <span class="font-medium text-slate-400">Related Projects:</span>
          {entry.data.projects.map(p => <ProjectBadge project={p} />)}
        </div>
        <span class="text-slate-300">•</span>
        <span class="flex items-center gap-2">
            <span class="font-medium text-slate-400">Difficulty:</span> 
            <span class={`capitalize px-2 py-0.5 rounded font-medium ${
          entry.data.difficulty === 'beginner' ? 'bg-green-100 text-green-700' : 
          entry.data.difficulty === 'intermediate' ? 'bg-yellow-100 text-yellow-800' : 'bg-red-100 text-red-700'
        }`}>{entry.data.difficulty}</span></span>
        <span class="text-slate-300">•</span>
        <span>Updated: {entry.data.lastUpdated.toLocaleDateString()}</span>
      </div>
    </div>

    <article class="prose prose-lg prose-slate max-w-none 
      prose-headings:font-bold prose-headings:text-slate-900 prose-headings:tracking-tight
      prose-a:text-brand-600 prose-a:no-underline hover:prose-a:underline
      prose-p:text-slate-600 prose-p:leading-relaxed
      prose-strong:text-slate-900 prose-strong:font-bold
      prose-pre:bg-slate-900 prose-pre:shadow-lg prose-pre:border prose-pre:border-slate-800
      prose-code:text-brand-700 prose-code:bg-brand-50 prose-code:px-1 prose-code:py-0.5 prose-code:rounded prose-code:before:content-none prose-code:after:content-none
      prose-li:text-slate-600">
      <Content components={{ Annotation }} />
    </article>

    <Comments client:visible />

    {entry.data.relatedConcepts.length > 0 && (
      <div class="mt-20 pt-10 border-t border-slate-100">
        <h3 class="text-lg font-bold text-slate-900 mb-6">Explore Related Concepts</h3>
        <div class="flex flex-wrap gap-3">
          {entry.data.relatedConcepts.map(slug => (
            <a href={`/concepts/${slug}`} class="px-4 py-2 bg-white border border-slate-200 rounded-full text-sm font-medium text-slate-600 hover:border-brand-300 hover:text-brand-700 hover:shadow-sm transition-all">
              {slug}
            </a>
          ))}
        </div>
      </div>
    )}
  </div>
</BaseLayout>
