---
import { getCollection } from "astro:content";
import BaseLayout from "../layouts/BaseLayout.astro";
import { ProjectBadge } from "../components";

export const prerender = false;

const updates = await getCollection("updates");
const sortedUpdates = updates.sort(
  (a, b) => b.data.date.valueOf() - a.data.date.valueOf(),
);
---

<BaseLayout title="Research Updates | Midnight Learning">
  <div class="max-w-3xl mx-auto">
    <div class="mb-12 pb-6 border-b border-slate-100">
      <h1 class="text-4xl font-extrabold text-slate-900 mb-2">
        Research & Development Updates
      </h1>
      <p class="text-slate-500 text-lg">
        Track the progress of our privacy research ecosystem.
      </p>
    </div>

    <div class="space-y-16">
      {
        sortedUpdates.map(async (update) => {
          const { Content } = await update.render();
          return (
            <article class="relative pl-8 border-l-2 border-slate-100 hover:border-brand-200 transition-colors">
              <div class="absolute -left-[9px] top-2 w-4 h-4 rounded-full bg-white border-4 border-slate-200" />

              <header class="mb-4">
                <div class="flex items-center gap-3 mb-2">
                  <time class="text-sm font-bold text-slate-400 font-mono tracking-wide">
                    {update.data.date.toLocaleDateString()}
                  </time>
                  {update.data.project !== "all" &&
                    update.data.project !== "platform" && (
                      <ProjectBadge
                        project={update.data.project as "edgechain" | "msingi"}
                      />
                    )}
                  {update.data.project === "platform" && (
                    <span class="text-xs font-bold px-2 py-0.5 rounded bg-brand-50 text-brand-600 border border-brand-100 uppercase tracking-wide">
                      Platform
                    </span>
                  )}
                  <span class="text-xs text-slate-500 font-semibold uppercase tracking-wide border border-slate-200 px-1.5 py-0.5 rounded bg-slate-50">
                    {update.data.type}
                  </span>
                </div>
                <h2 class="text-2xl font-bold text-slate-900 mb-1">
                  {update.data.title}
                </h2>
                <div class="text-sm text-slate-500 font-medium">
                  By {update.data.author}
                </div>
              </header>

              <div class="prose prose-slate max-w-none text-slate-600">
                <Content />
              </div>
            </article>
          );
        })
      }
    </div>
  </div>
</BaseLayout>
