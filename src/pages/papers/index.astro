---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { db } from "../../db";
import { papers } from "../../db/schema";
import { desc, eq } from "drizzle-orm";
import { PaperFeed } from "../../components/papers/PaperFeed";

export const prerender = false;

// Get approved papers from database
let dbPapers: (typeof papers.$inferSelect)[] = [];
try {
    console.log("[Papers] Fetching papers from DB...");
    dbPapers = await db
        .select()
        .from(papers)
        .where(eq(papers.curatorStatus, "approved"))
        .orderBy(desc(papers.createdAt));
    console.log(`[Papers] Found ${dbPapers.length} papers`);
} catch (error) {
    console.error("[Papers] DB Fetch Error:", error);
    // Don't crash the page, just show empty list
    dbPapers = [];
}
---

<BaseLayout
    title="Research Papers | Dura"
    description="A curated library of research papers translated for accessibility."
>
    <div class="max-w-5xl mx-auto mt-12 mb-20 px-4">
        <header class="mb-12 text-center md:text-left">
            <h1 class="text-5xl font-bold text-stone-900 mb-6 tracking-tight">
                Research Library
            </h1>
            <p class="text-xl text-stone-600 max-w-2xl leading-relaxed">
                Curated research papers translated for accessibility. Explore
                concepts in Privacy, AI, and Edge Computing through the lens of
                local context.
            </p>
        </header>

        <PaperFeed client:load papers={dbPapers} />
    </div>
</BaseLayout>
